<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hero bild | Admin - NorthWind Scatters</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .form-card {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      box-shadow: var(--shadow-md);
      margin-bottom: var(--space-6);
    }

    .form-card-title {
      font-size: var(--text-xl);
      margin-bottom: var(--space-4);
      padding-bottom: var(--space-3);
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }

    .preview-card {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      padding: var(--space-6);
      box-shadow: var(--shadow-md);
      margin-bottom: var(--space-6);
    }

    .preview-title {
      font-size: var(--text-lg);
      margin-bottom: var(--space-4);
    }

    .preview-image {
      width: 100%;
      max-height: 400px;
      object-fit: cover;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
    }

    .info-box {
      background: #EFF6FF;
      border-left: 4px solid var(--color-primary);
      padding: var(--space-4);
      border-radius: var(--radius-md);
      margin-top: var(--space-4);
    }

    .info-box h4 {
      margin: 0 0 var(--space-2) 0;
      color: var(--color-primary);
    }

    .info-box ul {
      margin: 0;
      padding-left: var(--space-5);
    }

    .info-box li {
      margin-bottom: var(--space-1);
      font-size: var(--text-sm);
    }
  </style>
</head>
<body data-page="hero">
  
  <div class="admin-layout">
    
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <div class="admin-brand">
        <div class="admin-brand-icon">N</div>
        <span class="admin-brand-text">NorthWind</span>
      </div>
      
      <nav>
        <ul class="admin-nav">
          <li class="admin-nav-item">
            <a href="admin-dashboard.html" class="admin-nav-link">
              üìä Dashboard
            </a>
          </li>
          <li class="admin-nav-item">
            <a href="admin-kittens.html" class="admin-nav-link">
              üê± Kattungar
            </a>
          </li>
          <li class="admin-nav-item">
            <a href="admin-cats.html" class="admin-nav-link">
              üêæ Mina katter
            </a>
          </li>
          <li class="admin-nav-item">
            <a href="admin-news.html" class="admin-nav-link">
              üì∞ Nyheter
            </a>
          </li>
          <li class="admin-nav-item">
            <a href="admin-hero.html" class="admin-nav-link active">
              üñºÔ∏è Hero bild
            </a>
          </li>
          <li class="admin-nav-item">
            <a href="admin-settings.html" class="admin-nav-link">
              ‚öôÔ∏è Inst√§llningar
            </a>
          </li>
          <li class="admin-nav-item" style="margin-top: var(--space-8);">
            <a href="index.html" class="admin-nav-link">
              üåê Visa sida
            </a>
          </li>
          <li class="admin-nav-item">
            <a href="admin-login.html" class="admin-nav-link">
              üö™ Logga ut
            </a>
          </li>
        </ul>
      </nav>
    </aside>
    
    <!-- Content -->
    <main class="admin-content">
      
      <div class="admin-header">
        <h1 class="admin-title">Hero bild</h1>
      </div>

      <form id="hero-form" onsubmit="saveHeroSettings(event)">
        
        <!-- Current Preview -->
        <div class="preview-card">
          <h3 class="preview-title">Nuvarande hero</h3>
          <img id="hero-preview" src="https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=1920&q=80" alt="Hero preview" class="preview-image">
        </div>
        
        <!-- Hero Settings -->
        <div class="form-card">
          <h2 class="form-card-title">Hero inst√§llningar</h2>
          
          <div class="form-group">
            <label class="form-label">Titel</label>
            <input type="text" name="hero_title" id="hero-title" class="form-input" value="NorthWind Scatters">
            <p class="form-hint">Stora rubriken p√• startsidan</p>
          </div>
          
          <div class="form-group">
            <label class="form-label">Undertext</label>
            <textarea name="hero_subtitle" id="hero-subtitle" class="form-textarea" rows="3">Norsk Skogskatt uppf√∂dning med k√§rlek och omsorg i Sverige. V√•ra katter √§r v√•r familj.</textarea>
            <p class="form-hint">Beskrivande text under titeln</p>
          </div>
          
          <div class="form-group">
            <label class="form-label">Bild URL</label>
            <input type="url" name="hero_image_url" id="hero-image-url" class="form-input" value="https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=1920&q=80" oninput="updatePreview()">
            <p class="form-hint">Direktl√§nk till bild (1920x1080 rekommenderat)</p>
          </div>
          
          <!-- Save Buttons -->
          <div style="display: flex; gap: var(--space-3);">
            <button type="submit" class="btn btn-primary">Spara √§ndringar</button>
            <button type="button" class="btn btn-outline" onclick="resetHero()">√Öterst√§ll</button>
          </div>
          
          <!-- Tips -->
          <div class="info-box">
            <h4>üí° Tips f√∂r b√§st resultat</h4>
            <ul>
              <li>Anv√§nd h√∂guppl√∂sta bilder (minst 1920x1080)</li>
              <li>V√§lj bilder med bra kontrast f√∂r text</li>
              <li>Undvik f√∂r ljusa eller m√∂rka bilder</li>
              <li>B√§sta format: JPG eller PNG</li>
              <li>Optimera bilden f√∂r webb innan uppladdning</li>
            </ul>
          </div>
        </div>
        
      </form>
      
    </main>
    
  </div>

  <script src="admin.js"></script>
  <script>
    // Update preview in real-time
    function updatePreview() {
      const imageUrl = document.getElementById('hero-image-url').value;
      const preview = document.getElementById('hero-preview');
      if (imageUrl && preview) {
        preview.src = imageUrl;
      }
    }

    // Load hero settings from database
    async function loadHeroSettings() {
      try {
        const { data: settings, error } = await supabaseClient
          .from('settings')
          .select('*')
          .in('key', ['hero_title', 'hero_subtitle', 'hero_image_url']);

        if (error) throw error;

        // Populate fields
        settings.forEach(setting => {
          const field = document.getElementById(setting.key.replace('hero_', 'hero-').replace('_url', '-url'));
          if (field) {
            let value = setting.value;
            if (typeof value === 'object') {
              value = JSON.stringify(value);
            }
            field.value = value;
          }
        });

        // Update preview
        updatePreview();
        
      } catch (error) {
        console.error('Error loading hero settings:', error);
      }
    }

    // Save hero settings
    async function saveHeroSettings(event) {
      event.preventDefault();
      
      const form = event.target;
      const formData = new FormData(form);
      
      const settingsToUpdate = [];
      
      for (let [key, value] of formData.entries()) {
        settingsToUpdate.push({ key, value });
      }

      try {
        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Sparar...';
        submitBtn.disabled = true;

        // Update each setting
        for (const setting of settingsToUpdate) {
          const { error } = await supabaseClient
            .from('settings')
            .upsert(setting, { onConflict: 'key' });
          
          if (error) throw error;
        }
        
        // Show success
        if (window.showSuccess) {
          showSuccess('Hero inst√§llningar sparade!');
        } else {
          alert('Hero inst√§llningar sparade!');
        }
        
        // Reset button
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        
      } catch (error) {
        console.error('Error saving hero settings:', error);
        
        // Show error
        if (window.showError) {
          showError('Kunde inte spara: ' + error.message);
        } else {
          alert('Kunde inte spara: ' + error.message);
        }
        
        // Reset button
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.textContent = 'Spara √§ndringar';
        submitBtn.disabled = false;
      }
    }

    // Reset to default
    async function resetHero() {
      if (!confirm('√Öterst√§ll hero till standard?')) {
        return;
      }

      const defaults = {
        hero_title: 'NorthWind Scatters',
        hero_subtitle: 'Norsk Skogskatt uppf√∂dning med k√§rlek och omsorg i Sverige.',
        hero_image_url: 'https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=1920&q=80'
      };

      try {
        for (const [key, value] of Object.entries(defaults)) {
          await supabaseClient
            .from('settings')
            .upsert({ key, value }, { onConflict: 'key' });
        }

        alert('Hero √•terst√§lld!');
        location.reload();
        
      } catch (error) {
        console.error('Error resetting hero:', error);
        alert('Kunde inte √•terst√§lla: ' + error.message);
      }
    }

    // Load on page load
    document.addEventListener('DOMContentLoaded', loadHeroSettings);
  </script>
</body>
</html>
